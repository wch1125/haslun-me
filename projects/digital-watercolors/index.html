<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Watercolors â€” Haslun Studio</title>
  <meta name="description" content="Watercolor paintings brought to life. An interactive sketchbook by Haslun Studio.">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¨</text></svg>">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #1a1a1a;
      --bg-card: #242424;
      --terracotta: #c4703f;
      --terracotta-light: #d4845a;
      --text-primary: #f5f5f5;
      --text-muted: #a0a0a0;
      --pixel-shadow: #0a0a0a;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      background: var(--bg-dark);
      color: var(--text-primary);
      font-family: 'DM Sans', sans-serif;
    }

    /* ========================================
       LOADING SCREEN
       ======================================== */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg-dark);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.6s ease, visibility 0.6s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }

    /* Pixel drops */
    .loading-drops {
      display: flex;
      gap: 8px;
      margin-bottom: 1rem;
      align-items: flex-end;
    }

    .loading-drop {
      width: 8px;
      height: 12px;
      image-rendering: pixelated;
      position: relative;
      animation: pixelBreathe 1600ms ease-in-out infinite;
      /* Pixelated drop shape via clip-path */
      clip-path: polygon(
        25% 0%, 75% 0%,
        100% 25%, 100% 75%,
        75% 100%, 25% 100%,
        0% 75%, 0% 25%
      );
    }

    .loading-drop::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 4px;
      background: inherit;
      opacity: 0;
      animation: pixelDrip 1600ms ease-in-out infinite;
    }

    /* Six drops - earthy watercolor palette */
    .loading-drop:nth-child(1) { 
      background: #c4703f;
      animation-delay: 0ms;
    }
    .loading-drop:nth-child(1)::after { animation-delay: 0ms; }

    .loading-drop:nth-child(2) { 
      background: #d4845a;
      animation-delay: -267ms;
    }
    .loading-drop:nth-child(2)::after { animation-delay: -267ms; }

    .loading-drop:nth-child(3) { 
      background: #b8986b;
      animation-delay: -534ms;
      width: 10px;
      height: 14px;
    }
    .loading-drop:nth-child(3)::after { animation-delay: -534ms; }

    .loading-drop:nth-child(4) { 
      background: #8b9a7d;
      animation-delay: -801ms;
      width: 10px;
      height: 14px;
    }
    .loading-drop:nth-child(4)::after { animation-delay: -801ms; }

    .loading-drop:nth-child(5) { 
      background: #5a7247;
      animation-delay: -1068ms;
    }
    .loading-drop:nth-child(5)::after { animation-delay: -1068ms; }

    .loading-drop:nth-child(6) { 
      background: #4a6a8a;
      animation-delay: -1335ms;
    }
    .loading-drop:nth-child(6)::after { animation-delay: -1335ms; }

    @keyframes pixelBreathe {
      0%, 100% {
        transform: translateY(0) scaleY(1);
        opacity: 0.7;
      }
      50% {
        transform: translateY(-6px) scaleY(1.15);
        opacity: 1;
      }
    }

    @keyframes pixelDrip {
      0%, 60%, 100% {
        opacity: 0;
        transform: translateX(-50%) translateY(0);
      }
      70% {
        opacity: 0.6;
        transform: translateX(-50%) translateY(2px);
      }
      85% {
        opacity: 0;
        transform: translateX(-50%) translateY(8px);
      }
    }

    /* Brand */
    .loading-brand {
      text-align: center;
      margin-bottom: 0.75rem;
    }

    .loading-brand-name {
      font-family: 'Cormorant Garamond', serif;
      font-size: 1.75rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      color: #f4e4c1;
      text-shadow: 2px 2px 0 #1a0f05;
    }

    .loading-brand-sub {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #8a7a5a;
      margin-top: 0.2rem;
    }

    /* Pixel progress bar */
    .loading-bar {
      width: 120px;
      height: 6px;
      background: #2a2520;
      border: 2px solid #3d3530;
      position: relative;
      overflow: hidden;
    }

    .loading-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, 
        #c4703f 0%, 
        #d4845a 20%, 
        #b8986b 40%, 
        #8b9a7d 70%, 
        #5a7247 100%
      );
      transition: width 0.3s ease;
    }

    .loading-tagline {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 0.85rem;
      color: #6a5a4a;
      margin-top: 0.75rem;
    }

    /* Animated Background */
    .background-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .background-animation canvas {
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      height: 100%;
      width: auto;
      max-width: none;
    }

    /* ========================================
       HERO OVERLAY + WINDOW
       ======================================== */
    .hero-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      perspective: 1200px;
      z-index: 2;
    }

    /* Vignette behind window */
    .hero-overlay::before {
      content: "";
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at center,
        rgba(0,0,0,0.0) 0%,
        rgba(0,0,0,0.25) 50%,
        rgba(0,0,0,0.6) 100%);
      pointer-events: none;
    }

    .hero-window {
      pointer-events: auto;
      transform-style: preserve-3d;
      transform: translate3d(0, 0, 0);
      max-width: min(420px, 90vw);
      transition: transform 0.08s ease-out;
    }

    /* Pixel-art glass panel base styles */
    .hero-header,
    .hero-menu {
      position: relative;
      background:
        /* subtle diagonal dither */
        repeating-linear-gradient(
          135deg,
          rgba(255,255,255,0.06) 0px,
          rgba(255,255,255,0.06) 1px,
          transparent 1px,
          transparent 3px
        );
      background-color: rgba(22, 12, 6, 0.88);
      border: 3px solid #c9a86c;
      box-shadow:
        0 16px 40px rgba(0,0,0,0.7),
        0 0 0 1px rgba(0,0,0,0.8),
        inset 0 1px 0 rgba(255,255,255,0.08);
      image-rendering: pixelated;
      backdrop-filter: blur(3px);
    }

    /* Connect header + menu into one vertical window */
    .hero-header {
      border-radius: 6px 6px 0 0;
      padding: 1.25rem 2rem 1rem;
      border-bottom: none;
    }

    .hero-menu {
      border-radius: 0 0 6px 6px;
      border-top: 1px solid rgba(0,0,0,0.5);
      padding: 0;
    }

    /* Inner highlight for depth */
    .hero-header::before,
    .hero-menu::before {
      content: "";
      position: absolute;
      inset: 2px;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 3px;
      pointer-events: none;
    }

    /* Pixel corner dots */
    .hero-header::after {
      content: "";
      position: absolute;
      width: 4px;
      height: 4px;
      background: #c9a86c;
      box-shadow:
        calc(100% - 7px) 0 0 #c9a86c;
      left: 3px;
      top: 3px;
      opacity: 0.7;
    }

    .hero-menu::after {
      content: "";
      position: absolute;
      width: 4px;
      height: 4px;
      background: #c9a86c;
      box-shadow:
        calc(100% - 7px) 0 0 #c9a86c;
      left: 3px;
      bottom: 3px;
      opacity: 0.7;
    }

    /* Title typography */
    .hero-title {
      margin: 0;
      font-family: 'Cormorant Garamond', serif;
      font-weight: 600;
      font-size: clamp(1.1rem, 2.8vw, 1.4rem);
      letter-spacing: 0.18em;
      text-transform: uppercase;
      text-align: center;
      color: #fef5e3;
      text-shadow:
        0 2px 0 rgba(0,0,0,0.9),
        0 0 20px rgba(0,0,0,0.8);
    }

    .hero-subtitle {
      margin: 0.4rem 0 0;
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 0.9rem;
      text-align: center;
      color: rgba(250,235,200,0.7);
      letter-spacing: 0.08em;
    }

    /* Menu panel styles */
    .menu-header {
      background: linear-gradient(180deg, rgba(100,70,35,0.9) 0%, rgba(70,50,25,0.95) 100%);
      padding: 0.5rem 1rem;
      border-bottom: 1px solid rgba(0,0,0,0.4);
    }

    .menu-header h2 {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #d4c4a4;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      margin: 0;
      text-align: center;
    }

    .menu-section {
      padding: 0.6rem 0.75rem;
      border-bottom: 1px dashed rgba(200,180,140,0.2);
    }

    .menu-section:last-child {
      border-bottom: none;
    }

    .menu-section-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: rgba(200,180,140,0.6);
      margin-bottom: 0.35rem;
      padding-left: 0.5rem;
      font-weight: 500;
    }

    .menu-items {
      display: flex;
      gap: 0.15rem;
      flex-direction: column;
    }

    .menu-item {
      font-family: 'DM Sans', sans-serif;
      font-size: 0.85rem;
      font-weight: 500;
      color: #e8dcc8;
      text-decoration: none;
      padding: 0.45rem 0.6rem;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 3px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.1s ease;
      cursor: pointer;
    }

    .menu-item::before {
      content: 'â—†';
      font-size: 0.45rem;
      color: #c9a86c;
      opacity: 0.4;
      transition: all 0.1s ease;
    }

    .menu-item:hover {
      background: rgba(200,168,108,0.15);
      border-color: rgba(200,168,108,0.4);
      color: #fef5e3;
    }

    .menu-item:hover::before {
      opacity: 1;
      color: #e8c080;
    }

    .menu-item.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .menu-item.disabled:hover {
      background: transparent;
      border-color: transparent;
    }

    .menu-item.disabled::before {
      opacity: 0.2;
    }

    .coming-soon {
      font-size: 0.6rem;
      color: rgba(200,180,140,0.5);
      font-style: italic;
      margin-left: auto;
    }

    .menu-item.scene-link {
      background: rgba(200,168,108,0.08);
    }

    .menu-item.scene-link:hover {
      background: rgba(200,168,108,0.2);
    }

    /* Footer */
    .footer {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      text-align: center;
      padding: 0.35rem 0.9rem;
      background: rgba(22, 12, 6, 0.7);
      border: 1px solid rgba(200,168,108,0.3);
      border-radius: 3px;
      backdrop-filter: blur(2px);
    }

    .footer p {
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      font-size: 0.75rem;
      color: rgba(200,180,140,0.7);
      margin: 0;
    }

    .footer a {
      color: #c9a86c;
      text-decoration: none;
    }

    .footer a:hover {
      color: #e8dcc8;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .hero-window {
        max-width: 92vw;
      }

      .hero-header {
        padding: 1rem 1.25rem 0.75rem;
      }

      .hero-title {
        font-size: 1.1rem;
        letter-spacing: 0.12em;
      }

      .hero-subtitle {
        font-size: 0.8rem;
      }
      
      .menu-header h2 {
        font-size: 0.65rem;
      }
      
      .menu-item {
        font-size: 0.8rem;
        padding: 0.4rem 0.5rem;
      }
    }
  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-drops">
      <div class="loading-drop"></div>
      <div class="loading-drop"></div>
      <div class="loading-drop"></div>
      <div class="loading-drop"></div>
      <div class="loading-drop"></div>
      <div class="loading-drop"></div>
    </div>
    <div class="loading-brand">
      <div class="loading-brand-name">Digital Watercolors</div>
      <div class="loading-brand-sub">Haslun Studio</div>
    </div>
    <div class="loading-bar">
      <div class="loading-bar-fill" id="loading-bar-fill"></div>
    </div>
    <div class="loading-tagline">paintings that breathe</div>
  </div>

  <div class="background-animation">
    <canvas id="bg-canvas"></canvas>
  </div>

  <!-- Hero Overlay with 3D parallax -->
  <div class="hero-overlay" id="hero-overlay">
    <div class="hero-window" id="hero-window">
      <header class="hero-header">
        <h1 class="hero-title">Digital Watercolors</h1>
        <p class="hero-subtitle">Paintings that breathe</p>
      </header>

      <section class="hero-menu">
        <div class="menu-header">
          <h2>âœ¦ Menu âœ¦</h2>
        </div>
        
        <!-- Scenes section - populated by JavaScript -->
        <div class="menu-section" id="scenes-section" style="display: none;">
          <div class="menu-section-label">Scenes</div>
          <div class="menu-items" id="scenes-menu"></div>
        </div>

        <!-- Static links -->
        <div class="menu-section">
          <div class="menu-section-label">Studio</div>
          <div class="menu-items">
            <a href="https://haslun.studio" class="menu-item" target="_blank">Gallery</a>
            <a href="https://haslun.studio/#prints" class="menu-item" target="_blank">Shop Prints</a>
            <a href="https://haslun.studio/watercolor-lab.html" class="menu-item" target="_blank">Color Lab</a>
          </div>
        </div>
      </section>
    </div>
  </div>

  <div class="footer">
    <p>Watercolors by <a href="https://haslun.studio" target="_blank">Haslun Studio</a></p>
  </div>

  <!-- Load scenes config -->
  <script src="scenes.js"></script>
  
  <script>
    // ========================================
    // HUB ANIMATION
    // ========================================
    const hubConfig = {
      frameCount: 20,
      framePath: 'hub-frames/frame-',
      frameExtension: '.png',
      frameDelay: 120,
      pingPong: true
    };

    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    const loadingScreen = document.getElementById('loading-screen');
    const loadingBarFill = document.getElementById('loading-bar-fill');

    const state = {
      frames: [],
      currentFrame: 0,
      direction: 1,
      lastFrameTime: 0,
      loaded: 0
    };

    function preloadFrames() {
      return new Promise((resolve) => {
        for (let i = 0; i < hubConfig.frameCount; i++) {
          const img = new Image();
          const frameNum = String(i).padStart(3, '0');
          img.src = `${hubConfig.framePath}${frameNum}${hubConfig.frameExtension}`;
          
          img.onload = () => {
            state.loaded++;
            
            // Update progress bar
            const progress = (state.loaded / hubConfig.frameCount) * 100;
            loadingBarFill.style.width = progress + '%';
            
            if (state.loaded === hubConfig.frameCount) {
              canvas.width = state.frames[0].width;
              canvas.height = state.frames[0].height;
              ctx.imageSmoothingEnabled = false;
              
              // Hide loading screen after brief delay
              setTimeout(() => {
                loadingScreen.classList.add('hidden');
              }, 400);
              
              resolve();
            }
          };
          
          state.frames[i] = img;
        }
      });
    }

    function drawFrame() {
      const img = state.frames[state.currentFrame];
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);
    }

    function animate(timestamp) {
      if (timestamp - state.lastFrameTime >= hubConfig.frameDelay) {
        state.lastFrameTime = timestamp;
        
        state.currentFrame += state.direction;
        
        if (state.currentFrame >= hubConfig.frameCount - 1) {
          state.currentFrame = hubConfig.frameCount - 1;
          state.direction = -1;
        } else if (state.currentFrame <= 0) {
          state.currentFrame = 0;
          state.direction = 1;
        }
        
        drawFrame();
      }
      
      requestAnimationFrame(animate);
    }

    // ========================================
    // BUILD SCENES MENU FROM CONFIG
    // ========================================
    function buildScenesMenu() {
      if (typeof SCENES === 'undefined' || SCENES.length === 0) return;
      
      const section = document.getElementById('scenes-section');
      const menu = document.getElementById('scenes-menu');
      
      SCENES.forEach(scene => {
        const item = document.createElement('a');
        item.className = 'menu-item scene-link' + (scene.ready ? '' : ' disabled');
        item.href = scene.ready ? `scenes/${scene.id}/` : '#';
        item.innerHTML = scene.label;
        
        if (!scene.ready) {
          item.innerHTML += '<span class="coming-soon">soon</span>';
          item.onclick = (e) => e.preventDefault();
        }
        
        menu.appendChild(item);
      });
      
      section.style.display = 'block';
    }

    // ========================================
    // 3D PARALLAX FOR HERO WINDOW
    // ========================================
    function initHeroParallax() {
      const heroOverlay = document.getElementById('hero-overlay');
      const heroWindow = document.getElementById('hero-window');
      
      if (!heroOverlay || !heroWindow) return;
      
      const maxRotate = 8;   // degrees
      const maxShift = 18;   // pixels

      function applyParallax(xNorm, yNorm) {
        const rotateY = (xNorm - 0.5) * -2 * maxRotate;
        const rotateX = (yNorm - 0.5) * 2 * maxRotate;
        const translateX = (xNorm - 0.5) * 2 * maxShift;
        const translateY = (yNorm - 0.5) * 2 * maxShift;

        heroWindow.style.transform = 
          `translate3d(${translateX}px, ${translateY}px, 0) ` +
          `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      }

      // Desktop: pointer/mouse movement
      window.addEventListener('pointermove', (e) => {
        const rect = heroOverlay.getBoundingClientRect();
        const xNorm = (e.clientX - rect.left) / rect.width;
        const yNorm = (e.clientY - rect.top) / rect.height;
        applyParallax(xNorm, yNorm);
      });

      // Mobile: device tilt
      window.addEventListener('deviceorientation', (e) => {
        if (e.gamma === null && e.beta === null) return;
        const xNorm = (e.gamma + 45) / 90;  // gamma: -45 to 45
        const yNorm = (e.beta - 30) / 60;   // beta: 0 to 60
        applyParallax(
          Math.min(1, Math.max(0, xNorm)),
          Math.min(1, Math.max(0, yNorm))
        );
      }, { passive: true });

      // Reset on mouse leave
      heroOverlay.addEventListener('mouseleave', () => {
        heroWindow.style.transform = 'translate3d(0, 0, 0) rotateX(0deg) rotateY(0deg)';
      });
    }

    // ========================================
    // INIT
    // ========================================
    buildScenesMenu();
    initHeroParallax();
    
    preloadFrames().then(() => {
      drawFrame();
      requestAnimationFrame(animate);
    });
  </script>

</body>
</html>
